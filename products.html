<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books_Details</title>


    <link rel="stylesheet" href="style.css">


    <link rel="stylesheet" href="products_responsive.css">


    <link rel="icon" href="./Book Logo.jpeg">

     <!-- AOS CSS -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" 
    integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" 
    crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>



</head>
<body>


   <!----------------------------------Preloader Section Here--------------------------------->

    <div id="preloader" class="preloader">
        
        <img src="./preloader-s-unscreen.gif" alt="">
        <p id="loader-text1" class="loader-text1"></p>
    </div>

    


  <p id="toast_cart" class="toast_cart">Item added to cart!</p>
  <p id="toast-existProduct" class="toast-existProduct">Item already exists in cart!</p>

<div class="container">

                            
<!-- Scroll to Top Button -->
                <button id="scrollTopBtn" title="Go to top">
                <i class="bi bi-arrow-up-short"></i>
                </button>


    <!-----------------------------------------Nav bar section here------------------------------------------>


                <div class="navbar" data-aos="fade-down">
                   
                      <img src="./Book Logo.jpeg" alt="">
                    <h1>Devotee's Book Store</h1>
                    


                    <ul>
                      
                      <li><button onclick="toggleCart_downbar()" title="Cart">Cart <i class="bi bi-cart"></i> </button></li>
                      <span class="cart-value" id="cart-value">0</span>
                    
                    </ul>

                  <!-----------------hamburger button ------------------------------------------------>


                          <div class="hamburger" onclick="toggleSidebar()">
                                    <i class="bi bi-list"></i>
                          </div>
                                          
                          

                </div>


                                                                          
 <!-------------------------------------- Sidebar (initially hidden) ------------------------------------------------->


                          <div id="sidebar" class="sidebar">
                              <span class="close-btn" onclick="toggleSidebar()" title="close">✖</span>
                              <ul>
                                <li><a href="">My Profile</a></li>
                                <li><a href="#">Forgot Password </i></a></li>
                                <li><a href="">About</a></li>
                                <li><a href="">Contact us </a></li>
                                <button><a href="">Logout <i class="bi bi-box-arrow-right"></i></a></button>
                              </ul>

                          </div>



                          <!-- Overlay -->
                      <div id="overlay" class="overlay" ></div>


<!-----------------------------------Cart Down side bar section here------------------------------------------------->

                      <div class="cart-downbar" id="cart_downbar">
                        <button class="close-btn" onclick="toggleCart_downbar()" title="close" ><i class="bi bi-x-circle-fill"></i></button>

                           <h1>Book Store Cart <i class="bi bi-cart"></i></h1>
                           
                            <div class="cart-container-items">
                              
                            <div class="cart-items" id="cart">
                                    <!-- Cart items will be dynamically added here -->
                                    <p id="empty-cart-message">Your cart is Empty!</p>
                                    <h4 id="cartEmpty"></h4>
                                    <div id="output">

                                    </div>
                                </div>
                            </div>

                       <p id="totalPrice">Total: ₹ 0.00</p> 


                        <button class="checkout-btn" title="checkout" onclick="checkout()">Proceed to Checkout</button>

                      </div>


                      <!-- Overlay -->
                      <div id="overlay" class="overlay" ></div>

</div>
    
<!----------------------------------------Details section here---------------------------------------------->


            <div class="detail">

                <h1 data-aos="fade-down">BOOK DETAILS</h1>
                <a href="main.html" class="arrow" data-aos="fade-right"><i class="bi bi-arrow-left"></i></a>
                                    
                    <div class="image" >
                        <img src="" alt=""data-aos="fade-up">
                    </div>


                    <div class="name" data-aos="fade-left">

                    </div>

                    <div class="price" data-aos="fade-left">

                    </div>

                    <h2 data-aos="fade-right">Product Description</h2>
                    <div class="description" data-aos="fade-up">
                        
                        

                    </div>


    
            </div>


<!-------------------------------------button section here------------------------------------------>


<div class="addCart">
  <button id="loadData" onclick="updateCart(1)"><i class="bi bi-cart" ></i> Add to Cart</button>
</div>


<!-----------------------------------------Footer section here------------------------------------------>



<div class="footer-bottom-section">
    <p>&copy; 2025 Devotee's Book Store. All rights reserved.</p>
  </div>



    <!-----------------------------------------Scripting section here------------------------------------------>
<script src="addtoCart.js"></script>

    <!-- AOS JS -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 1000, // Animation duration in ms
    once: false,     // Only animate once
  });
</script>


<!-----------------------------Scroll to top section here---------------------------------------->


<script>
   // Scroll to top button logic
  const scrollTopBtn = document.getElementById("scrollTopBtn");
  window.onscroll = function () {
    if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
      scrollTopBtn.style.display = "block";
    } else {
      scrollTopBtn.style.display = "none";
    }
  };

  scrollTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
</script>



<!--------------------------------------- Hamburger side bar section here----------------------------------------->



<script>
  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    // Toggle active class
    sidebar.classList.toggle("active");
    overlay.classList.toggle("active");
  }
</script>



<script>
  function toggleCart_downbar(){

    const cart_downbar = document.getElementById("cart_downbar");
    const overlay = document.getElementById("overlay");

    cart_downbar.classList.toggle("active");
    overlay.classList.toggle("active");
  }
</script>



<!----------------------------------Show Toast Cart message section here--------------------->

<script>
    function showToast_cart() {
        var toast = document.getElementById("toast_cart");
        toast.classList.add("show");
        setTimeout(function() {
            toast.classList.remove("show");
        }, 3000); // Hide toast after 3 seconds
    }
</script>




<!----------------------------------Show Toast existing product message section here--------------------->


<script>
    function showToast_exist() {
        var toast = document.getElementById("toast-existProduct");
        toast.classList.add("show");
        setTimeout(function() {
            toast.classList.remove("show");
        }, 2000); // Hide toast after 3 seconds
    }
</script>




<!------------------------------------Preloader Animation Script Section Here-------------------------------->


<script>
    var loader = document.getElementById('preloader');
    var loader_text = document.getElementById('loader-text1')

    window.addEventListener('load',function(){
        loader_text.innerHTML='Please wait a moment...'
        
        setTimeout(function (){
            loader.style.display = "none";
            

        },700);
    }
)
</script>





<script>

  function checkout(){

    window.location.href = "checkout.html";
  }
</script>


    
<script>

        let products = null;
        
        // Fetch data from products.json
        fetch("products.json")
          .then((response) => response.json())
          .then((data) => {
            products = data;
            showDetail();
          });
        
        function showDetail() {
          const detail = document.querySelector(".detail");
          const productId = new URLSearchParams(window.location.search).get("id");
          const thisProduct = products.find((p) => p.id == productId);
        
          if (!thisProduct) {
            window.location.href = "/";
            return;
          }
        
          // Populate product details
          detail.querySelector(".image img").src = thisProduct.image;
          detail.querySelector(".name").innerText = thisProduct.name;
          detail.querySelector(".price").innerText = "Rs." + thisProduct.price;
          detail.querySelector(".description").innerText = thisProduct.description;
          detail.querySelector(".short-desc").innerText = thisProduct.short-desc;
        }


</script>


<!------------------------------Cart Section---------------------------------->

<script>

  document.addEventListener("DOMContentLoaded", function () {
          const cartItems = document.querySelector(".cart-items");
          const totalPriceElement = document.getElementById("totalPrice");
        
          loadCartFromLocalStorage();
        
          document.getElementById("loadData").addEventListener("click", function () {
            const productId = new URLSearchParams(window.location.search).get("id");
            

            const existingProduct = document.querySelector(`.cart-item[data-id="${productId}"]`);
if (existingProduct) {
  showToast_exist(); // Show toast message for existing product
  recalculateCartValue(); // Update cart count
  return;
}

else {
  showToast_cart(); // Show toast message for new product
}

            

        



            
            
          
//----------------------------------------------------Fetch product data and add to cart----------------------------------

            // Fetch product data from JSON file

            fetch("products.json")
              .then((response) => response.json())
              .then((data) => {
                const product = data.find((p) => p.id == productId);
                if (product) {
                  
                  addProductToCart(product);
                  saveCartToLocalStorage();
                  

                } else {
                  alert("Product not found.");
                }
              });
          });


//-------------------------------------------Toggle empty cart message--------------------------------------




function toggleEmptyCartMessage() {
    let cartItems = document.querySelectorAll(".cart-item");
    let message = document.getElementById("empty-cart-message");

    if (cartItems.length === 0) {
        message.style.display = "block";
    } else {
        message.style.display = "none";
    }
}



        
//--------------------------------------------Add product to cart function-------------------------------------


function addProductToCart(product, fromStorage = false) {
    let existingProduct = document.querySelector(`.cart-item[data-id="${product.id}"]`);

    const quantityToAdd = product.quantity || 1;

    if (existingProduct) {
        if (fromStorage) return; // Don't increase if loading from storage

        const quantityElement = existingProduct.querySelector(".cart-quantity");
        const quantityDisplay = existingProduct.querySelector(".quantity-display");
        const priceElement = existingProduct.querySelector(".cart-price");
        const unitPrice = parseFloat(existingProduct.getAttribute("data-price"));

        let quantity = parseInt(quantityElement.textContent) + quantityToAdd;

        quantityElement.textContent = quantity;
        quantityDisplay.textContent = quantity;
        priceElement.textContent = (unitPrice * quantity).toFixed(2);

        saveCartToLocalStorage();
        updateTotalPrice();
        toggleEmptyCartMessage();
        
        return;
    }

    // If not existing, create a new cart item
    let productDiv = document.createElement("div");
    productDiv.classList.add("cart-item");
    productDiv.setAttribute("data-id", product.id);
    productDiv.setAttribute("data-price", parseFloat(product.price).toFixed(2));

    productDiv.innerHTML = `
        <img src="${product.image}" class="cart-image" alt="${product.name}" />
        <p class="cart-name">${product.name}</p>
        <p class="quantity-number">Qty : <span class="quantity-display">${quantityToAdd}</span></p>

        <div class="cart-quantity-controls">
            <button class="decrement"><i class="bi bi-dash-circle-fill"></i></button>
            <span class="cart-quantity">${quantityToAdd}</span>
            <button class="increment"><i class="bi bi-plus-circle-fill"></i></button>
        </div>

        <p class="cart-price">${(parseFloat(product.price) * quantityToAdd).toFixed(2)}</p>
        <i class="bi bi-trash"></i><hr>
    `;

    cartItems.appendChild(productDiv);
    saveCartToLocalStorage();
    updateTotalPrice();
    recalculateCartValue(); // Update cart count

    // Attach event listeners
    productDiv.querySelector(".increment").addEventListener("click", function () {
        updateQuantity(product.id, 1);
    });

    productDiv.querySelector(".decrement").addEventListener("click", function () {
        updateQuantity(product.id, -1);
    });

    productDiv.querySelector(".bi-trash").addEventListener("click", function () {
        removeProductFromCart(product.id);
    });

    saveCartToLocalStorage();
    updateTotalPrice();
    toggleEmptyCartMessage();

}





//---------------------------------------Update quantity function section here----------------------------------


function updateQuantity(productId, change) {
    let productElement = document.querySelector(`.cart-item[data-id="${productId}"]`);
    if (!productElement) return;

    const quantityElement = productElement.querySelector(".cart-quantity");
    const quantityDisplay = productElement.querySelector(".quantity-display");
    const priceElement = productElement.querySelector(".cart-price");
    const unitPrice = parseFloat(productElement.getAttribute("data-price"));

    let quantity = parseInt(quantityElement.textContent) + change;

    if (quantity < 1) {
        removeProductFromCart(productId, size);
        return;
    }

    quantityElement.textContent = quantity;
    quantityDisplay.textContent = quantity;
    priceElement.textContent = (unitPrice * quantity).toFixed(2);

    saveCartToLocalStorage();
    recalculateCartValue();
    updateTotalPrice();
}




//---------------------------------------------Save cart to local storage function section here----------------------------------


function saveCartToLocalStorage() {
    const cartItemsElements = document.querySelectorAll(".cart-item");
    const cartData = [];

    cartItemsElements.forEach(item => {
        cartData.push({
            id: item.getAttribute("data-id"),
            price: item.getAttribute("data-price"),
            quantity: parseInt(item.querySelector(".cart-quantity").textContent),
            name: item.querySelector(".cart-name").textContent,
            image: item.querySelector(".cart-image").getAttribute("src")
        });
    });

    localStorage.setItem("cart", JSON.stringify(cartData));
}
toggleEmptyCartMessage();



//-------------------------------------------Load cart from local storage function section here----------------------------------


function loadCartFromLocalStorage() {
    const cartData = JSON.parse(localStorage.getItem("cart")) || [];

    cartData.forEach(product => {
        addProductToCart(product, true); // prevent duplicate quantity/price
    });


    
    updateTotalPrice();
    toggleEmptyCartMessage();
}
document.addEventListener("DOMContentLoaded", loadCartFromLocalStorage);



// -----------------------------------------Function to recalculate total cart count------------------------------------


function recalculateCartValue() {
    let totalItems = 0;

    document.querySelectorAll(".cart-quantity").forEach(item => {
        totalItems += parseInt(item.textContent);
    });

    // Update both localStorage and UI
    localStorage.setItem("cartValue", totalItems);
    document.getElementById("cart-value").textContent = totalItems || 0; // Set to 0 if empty
}
// Recalculate cart value on page load
document.addEventListener("DOMContentLoaded", function () {
    recalculateCartValue();
});






//----------------------------- ------------------Remove product from cart function section here----------------------------------


function removeProductFromCart(productId) {
    document.querySelector(`.cart-item[data-id='${productId}']`).remove();
    saveCartToLocalStorage();
    updateTotalPrice();
    recalculateCartValue();
    toggleEmptyCartMessage();
}


//------------------------------------Update total price function section here----------------------------------


function updateTotalPrice() {
    let total = 0;
    document.querySelectorAll(".cart-item").forEach(item => {
        let price = parseFloat(item.querySelector(".cart-price").textContent.replace("$", ""));
        total += price;
    });
    totalPriceElement.textContent = `Total: ₹${total.toFixed(2)}`;
}
});


</script>
  


<!------------------------------------Updating Cart value scripting section here-------------------------------->
   
<script>

// Function to update cart value
// Function to update cart value dynamically
function updateCart(value) {
    const cartValue = document.getElementById("cart-value");
    let currentValue = parseInt(localStorage.getItem("cartValue")) || 0;

    // Update value
    currentValue += value;
    currentValue = Math.max(0, currentValue); // Ensure value is not negative

    // Update localStorage and UI

    localStorage.setItem("cartValue", currentValue);
    cartValue.textContent = currentValue; 
}




</script>



<script src="products.js"></script>



</body>
</html>
